syntax = "proto3";
option go_package = "github.com/djpiper28/rpg-book/desktop_client/backend/pb_project";
import 'common.proto';
import 'project_character.proto';
import 'project_note.proto';

service ProjectSvc {
  rpc CreateProject(CreateProjectReq) returns (ProjectHandle) {}
  rpc OpenProject(OpenProjectReq) returns (OpenProjectResp) {}
  rpc RecentProjects(Empty) returns (RecentProjectsResp) {}
  rpc CloseProject(ProjectHandle) returns (Empty) {}

  rpc CreateCharacter(CreateCharacterReq) returns (CharacterHandle) {}
  rpc UpdateCharacter(UpdateCharacterReq) returns (Empty) {}
  rpc GetCharacter(GetCharacterReq) returns (GetCharacterResp) {}
  rpc DeleteCharacter(DeleteCharacterReq) returns (Empty) {}
  rpc SearchCharacter(QueryReq) returns (SearchCharacterResp) {}

  rpc CreateNote(CreateNoteReq) returns (NoteHandle) {}
  rpc GetNote(GetNoteReq) returns (GetNoteResp) {}
  rpc SearchNote(QueryReq) returns (SearchNoteResp) {}
  rpc UpdateNote(UpdateNoteReq) returns (Empty) {}
  rpc DeleteNote(DeleteNoteReq) returns (Empty) {}
}

message CreateProjectReq {
  string projectName = 1;
  string fileName = 2;
}

message OpenProjectReq {
  string fileName = 1;
}

message ProjectHandle {
  // ID that the backend is using to track the project, changes per open
  string id = 1;
}

message OpenProjectResp {
  ProjectHandle handle = 1;
  repeated BasicCharacterDetails characters = 2;
  repeated Note notes = 3;
}

message RecentProject {
  string projectName = 1;
  string fileName = 2;
  int64 fileSizeBytes = 3;
  string lastOpened = 4;
}

message RecentProjectsResp {
  repeated RecentProject projects = 1;
}

message CreateCharacterReq {
  ProjectHandle project = 1;
  BasicCharacterDetails details = 4;
  string icon_path = 5;
}

message GetCharacterReq {
  CharacterHandle character = 1;
  ProjectHandle project = 2;
}

message GetCharacterResp {
  BasicCharacterDetails details = 1;
  bytes icon = 2;
  repeated Note notes = 3;
}

message UpdateCharacterReq {
  CharacterHandle handle = 1;
  ProjectHandle project = 2;
  BasicCharacterDetails details = 3;
  bool set_icon = 4;
  string icon_path = 5;
}

message DeleteCharacterReq {
  ProjectHandle project = 1;
  CharacterHandle handle = 2;
}

message QueryReq {
  ProjectHandle project = 1;
  string query = 2;
}

message SearchCharacterResp {
  repeated CharacterHandle details = 1;
}

message CreateNoteReq {
  ProjectHandle project = 1;
  NoteDetails details = 2;
  repeated CharacterHandle characters = 3;
}

message GetNoteReq {
  ProjectHandle project = 1;
  NoteHandle note = 2;
}

message GetNoteResp {
  Note details = 1;
  repeated BasicCharacterDetails characters = 2;
}

message SearchNoteResp {
  repeated NoteHandle details = 1;
}

message UpdateNoteReq {
  NoteHandle handle = 1;
  ProjectHandle project = 2;
  NoteDetails details = 3;
  repeated CharacterHandle characters = 4;
}

message DeleteNoteReq {
  ProjectHandle project = 1;
  NoteHandle handle = 2;
}
